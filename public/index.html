<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pippor & 2tee</title>
    <link rel="icon" href="assets/icon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="style.css" />
    <script src="config.js"></script>
</head>
<body class="bg-accent-light text-gray-800">

    <!-- Navbar (แถบนำทาง) -->
    <nav class="fixed top-0 left-0 w-full bg-white shadow-lg z-50 transition-shadow duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Brand -->
                <a href="index.html" class="flex-shrink-0 text-2xl font-bold text-primary-blue hover:text-blue-700 transition duration-150">
                    PTTP
                </a>

                <!-- Desktop Menu -->
                <div class="hidden md:flex md:space-x-4">
                    <!-- Profile -->
                    <a href="#profile" class="text-gray-600 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition duration-150">
                        <i data-lucide="user" class="inline-block w-4 h-4 mr-1"></i> Profile
                    </a>

                    <!-- Works Dropdown -->
                    <div class="relative group">
                        <button class="flex items-center text-gray-600 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition duration-150 focus:outline-none">
                            <i data-lucide="clapperboard" class="inline-block w-4 h-4 mr-1"></i> Works
                            <i data-lucide="chevron-down" class="ml-1 w-4 h-4 transition-transform duration-200 group-hover:rotate-180"></i>
                        </button>
                        <div class="absolute top-full hidden group-hover:block w-52 bg-white shadow-2xl rounded-xl ring-1 ring-black ring-opacity-5 z-20 overflow-hidden">
                            <a href="#series" class="block px-4 py-2 text-sm text-gray-700 hover:bg-accent-light hover:text-primary-blue transition duration-150">
                                <i data-lucide="monitor-play" class="inline-block w-4 h-4 mr-1"></i> Series
                            </a>
                            <a href="#music" class="block px-4 py-2 text-sm text-gray-700 hover:bg-accent-light hover:text-primary-blue transition duration-150 border-t border-gray-100">
                                <i data-lucide="music" class="inline-block w-4 h-4 mr-1"></i> Musics
                            </a>
                            <a href="#magazine" class="block px-4 py-2 text-sm text-gray-700 hover:bg-accent-light hover:text-primary-blue transition duration-150 border-t border-gray-100">
                                <i data-lucide="book-open" class="inline-block w-4 h-4 mr-1"></i> Magazines
                            </a>
                        </div>
                    </div>

                    <!-- Works Dropdown -->
                     <a href="#shows" class="text-gray-600 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition duration-150">
                        <i data-lucide="radio" class="inline-block w-4 h-4 mr-1"></i> Shows
                    </a>

                    <!-- Brand & Awards Dropdown -->
                    <div class="relative group">
                        <button class="flex items-center text-gray-600 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition duration-150 focus:outline-none">
                            <i data-lucide="star" class="inline-block w-4 h-4 mr-1"></i> Brand & Awards
                            <i data-lucide="chevron-down" class="ml-1 w-4 h-4 transition-transform duration-200 group-hover:rotate-180"></i>
                        </button>
                        <div class="absolute top-full hidden group-hover:block w-52 bg-white shadow-2xl rounded-xl ring-1 ring-black ring-opacity-5 z-20 overflow-hidden">
                            <a href="#brand-presenter" class="block px-4 py-2 text-sm text-gray-700 hover:bg-accent-light hover:text-primary-blue transition duration-150">
                                <i data-lucide="megaphone" class="inline-block w-4 h-4 mr-1"></i> Brand Presenter
                            </a>
                            <a href="#awards" class="block px-4 py-2 text-sm text-gray-700 hover:bg-accent-light hover:text-primary-blue transition duration-150 border-t border-gray-100">
                                <i data-lucide="award" class="inline-block w-4 h-4 mr-1"></i> Awards
                            </a>
                        </div>
                    </div>

                    <!-- Schedule -->
                    <a href="#schedule" class="text-gray-600 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition duration-150">
                        <i data-lucide="calendar" class="inline-block w-4 h-4 mr-1"></i> Schedule
                    </a>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-primary-blue focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-blue transition duration-150" aria-expanded="false">
                        <!-- Icon when menu is closed -->
                        <i data-lucide="menu" id="menu-icon" class="block h-6 w-6"></i>
                        <!-- Icon when menu is open (Hidden initially) -->
                        <i data-lucide="x" id="close-icon" class="hidden h-6 w-6"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu (Collapsed by default) -->
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#profile" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                    <i data-lucide="user" class="inline-block w-4 h-4 mr-2"></i> Profile
                </a>

                <div>
                    <button id="mobile-works-toggle" class="w-full flex justify-between items-center text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" aria-expanded="false">
                        <span><i data-lucide="clapperboard" class="inline-block w-4 h-4 mr-2"></i> Works</span>
                        <i data-lucide="chevron-down" id="mobile-works-chevron" class="w-4 h-4 transform transition-transform duration-200"></i>
                    </button>
                    <div id="mobile-works-submenu" class="pl-6 pt-1 hidden space-y-1">
                        <a href="#series" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                            <i data-lucide="monitor-play" class="inline-block w-4 h-4 mr-2"></i> Series
                        </a>
                        <a href="#music" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                            <i data-lucide="music" class="inline-block w-4 h-4 mr-2"></i> Musics
                        </a>
                        <a href="#magazine" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                            <i data-lucide="book-open" class="inline-block w-4 h-4 mr-2"></i> Magazines
                        </a>
                    </div>
                </div>

                <a href="#shows" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                    <i data-lucide="radio" class="inline-block w-4 h-4 mr-2"></i> Shows
                </a>

                <!-- Brand & Awards -->
                <div>
                    <button id="mobile-awards-toggle" class="w-full flex justify-between items-center text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" aria-expanded="false">
                        <span><i data-lucide="star" class="inline-block w-4 h-4 mr-2"></i> Brand & Awards</span>
                        <i data-lucide="chevron-down" id="mobile-awards-chevron" class="w-4 h-4 transform transition-transform duration-200"></i>
                    </button>
                    <div id="mobile-awards-submenu" class="pl-6 pt-1 hidden space-y-1">
                        <a href="#brand-presenter" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                            <i data-lucide="megaphone" class="inline-block w-4 h-4 mr-2"></i> Brand Presenter
                        </a>
                        <a href="#awards" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                            <i data-lucide="award" class="inline-block w-4 h-4 mr-2"></i> Awards
                        </a>
                    </div>
                </div>

                <!-- ตารางงาน -->
                <a href="#schedule" class="block text-gray-800 hover:bg-primary-blue hover:text-white px-3 py-2 rounded-lg text-base font-medium transition duration-150" onclick="closeMobileMenu()">
                    <i data-lucide="calendar" class="inline-block w-4 h-4 mr-2"></i> Schedule
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content (Padding added to offset fixed navbar) -->
    <main class="pt-16">

        <!-- หน้าประวัติส่วนตัว (Profile) -->
        <section id="profile" class="py-16 px-4 md:py-24 md:px-8 bg-white border-b-4 border-primary-blue">
            <!-- <h1 class="text-4xl sm:text-5xl font-extrabold text-primary-blue text-center mb-12">
                หน้าประวัติส่วนตัว
            </h1> -->

            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-7xl mx-auto">
                
                <!-- Profile 1 -->
                <div class="text-center">
                    <div class="relative w-80 h-120 mx-auto mb-6">
                        <img src="https://pbs.twimg.com/media/GuB0uEoWMAAHVIT?format=jpg&name=large" alt="por" 
                            class="rounded-full object-cover w-full h-full border-4 border-secondary-blue shadow-xl">
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Por</h2>
                    <!-- <p class="text-gray-600 mb-6">Rising actor-singer who debuted as a main member of DVI after competing on LAZiCON. Notable role as Punlee in Your Sky Series; upcoming as Qin in Duang With You Series.</p> -->
                    <div class="bg-accent-light p-6 rounded-xl shadow-lg text-left max-w-sm mx-auto">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-3">Suppakarn Jirachotikul</h3>
                        <ul class="space-y-2 text-gray-600">
                            <li><span class="font-semibold text-primary-blue">Date of Birth: </span>17 October 2002</li>
                            <li><span class="font-semibold text-primary-blue">Hashtag: </span>#porsuppakarn</li>
                            <li class="flex items-center space-x-4 social-links">
                                <a href="https://x.com/porsuppakarn" target="_blank" class="text-primary-blue hover:text-gray-800">
                                    <i class="fa-brands fa-x-twitter text-xl"></i>
                                </a>
                                <a href="https://www.instagram.com/porsuppakarn" target="_blank" class="text-primary-blue hover:text-pink-500">
                                    <i class="fa-brands fa-instagram text-xl"></i>
                                </a>
                                <a href="https://www.tiktok.com/@porsuppakarn" target="_blank" class="text-primary-blue hover:text-gray-800">
                                    <i class="fa-brands fa-tiktok text-xl"></i>
                                </a>
                                <a href="https://weibo.com/u/7910928995" target="_blank" class="text-primary-blue hover:text-red-500">
                                    <i class="fa-brands fa-weibo text-xl"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Profile 2 -->
                <div class="text-center">
                    <div class="relative w-80 h-120 mx-auto mb-6">
                        <img src="https://pbs.twimg.com/media/Gt93Ot5WYAAMRKO?format=jpg&name=4096x4096" alt="Teetee" 
                            class="rounded-full object-cover w-full h-full border-4 border-secondary-blue shadow-xl">
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">TeeTee</h2>
                    <!-- <p class="text-gray-600 mb-6">New-generation actor recognized from DMD Friendship the Reality. Trained via TO BE NUMBER ONE IDOL. Appeared as Glaijai in Your Sky Series, with an upcoming lead as Duang in Duang With You Series.</p> -->
                    <div class="bg-accent-light p-6 rounded-xl shadow-lg text-left max-w-sm mx-auto">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-3">Wanpichit Nimitparkpoom</h3>
                        <ul class="space-y-2 text-gray-600">
                            <li><span class="font-semibold text-primary-blue">Date of Birth: </span>20 March 2005</li>
                            <li><span class="font-semibold text-primary-blue">Hashtag: </span>#twnpich</li>
                            <li class="flex items-center space-x-4 social-links">
                                <a href="https://x.com/twnpich" target="_blank" class="text-primary-blue hover:text-gray-800">
                                    <i class="fa-brands fa-x-twitter text-xl"></i>
                                </a>
                                <a href="https://www.instagram.com/twnpich/" target="_blank" class="text-primary-blue hover:text-pink-500">
                                    <i class="fa-brands fa-instagram text-xl"></i>
                                </a>
                                <a href="https://www.tiktok.com/@teetee.wpc" target="_blank" class="text-primary-blue hover:text-gray-800">
                                    <i class="fa-brands fa-tiktok text-xl"></i>
                                </a>
                                <a href="https://weibo.com/u/7978599852" target="_blank" class="text-primary-blue hover:text-red-500">
                                    <i class="fa-brands fa-weibo text-xl"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
        </section>

        <!-- ซีรีส์ (Series) -->
        <section id="series" class="py-16 px-4 md:py-24 md:px-8 bg-accent-light border-b border-gray-200">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Series
                </h2>
                <div id="filmography-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                    <p class="text-center col-span-full p-8 text-gray-600">loading data...</p>
                </div>
            </div>
        </section>
        <div id="details-modal" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300 bg-black/50 flex items-center justify-center p-4" onclick="closeDetailsModal()">
            <div class="bg-card-bg w-full max-w-3xl rounded-xl shadow-2xl transform transition-all duration-300" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center p-4 border-b border-gray-200">
                    <h3 id="modal-title" class="text-2xl font-bold text-gray-900">Title</h3>
                    <button onclick="closeDetailsModal()" class="text-gray-400 hover:text-gray-700 transition duration-150 p-2 rounded-full hover:bg-gray-100">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div class="modal-body overflow-y-auto p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div id="modal-poster-container" class="md:col-span-1">
                            <div class="relative w-full aspect-[3/4] mx-auto max-w-xs group">
                                <img id="modal-poster-slider" src="https://placehold.co/300x400/cccccc/333333?text=POSTER+N/A" alt="Film image" class="w-full h-full rounded-lg shadow-lg object-cover">
                                
                                <button id="nav-left" onclick="navigateImage(-1)" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full ml-2 opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-30">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                </button>
                                
                                <button id="nav-right" onclick="navigateImage(1)" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full mr-2 opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-30">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                </button>
        
                                <div id="image-counter" class="absolute bottom-2 left-1/2 transform -translate-x-1/2 bg-black/50 text-white text-xs px-2 py-1 rounded-full"></div>
                            </div>
                        </div>
                        
                        <!-- Details -->
                        <div class="md:col-span-1 space-y-4 text-base text-gray-700">
                            <h4 class="text-xl font-semibold text-primary-blue mb-3 border-b pb-2">Work Details</h4>
                            <p id="modal-role"></p>
                            <p id="modal-date"></p>
                            <p id="modal-platform"></p>
                            <p id="modal-episodes"></p>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer (Watch Now Button) -->
                <div class="p-4 border-t border-gray-200 flex justify-end">
                    <a id="modal-link" href="#" target="_blank" 
                    class="bg-primary-blue text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-secondary/90 transition duration-300 transform hover:scale-[1.02] text-center w-full md:w-auto">
                        Watch Now
                    </a>
                </div>

            </div>
        </div>
        <script>
            let filmographyData = [];
            let currentImageIndex = 0;
            let currentFilmImages = [];
            
            const range = 'series!A2:Z';

            const GSHEET_URL = `/api/spreadsheets?range=${encodeURIComponent(range)}`;
            
            const keys = ['title', 'role', 'role2', 'date', 'platform', 'episodes', 'link', 'link2', 'poster', 'image2', 'image3', 'image4'];

            function parseSheetsV4Data(json) {
                const data = [];
                const rows = json.values;
                if (!rows || rows.length === 0) return data; 

                // Assuming no header row is included in the specified RANGE (A2:Z or similar)
                rows.forEach(row => {
                    const entry = {};
                    keys.forEach((key, j) => {
                        // Map column data to keys
                        entry[key] = row[j] || ''; 
                    });
                    
                    // Basic check to ensure valid entry
                    if (entry.title) {
                        data.push(entry);
                    }
                });

                return data;
            }

            async function fetchFilmographyData() {
                const listContainer = document.getElementById('filmography-list');
                if (listContainer) {
                    listContainer.innerHTML = '<p class="text-center col-span-full p-8 text-gray-600">Loading filmography data...</p>';
                }

                try {
                    const response = await fetch(GSHEET_URL);
                    const json = await response.json();

                    if (!response.ok || json.error) {
                        throw new Error(`API Error: ${json.error?.message || response.statusText}`);
                    }
                    
                    filmographyData = parseSheetsV4Data(json);

                    if (filmographyData.length > 0) {
                        generateFilmCards();
                    } else {
                        listContainer.innerHTML = '<p class="text-red-600 text-center col-span-full p-8 bg-white rounded-xl shadow-lg">⚠️ No filmography data found in Google Sheet. Check your RANGE and API Key permissions.</p>';
                    }

                } catch (error) {
                    console.error("Could not fetch data:", error);
                    if(listContainer) {
                        listContainer.innerHTML = `<p class="text-red-600 text-center col-span-full p-8 bg-white rounded-xl shadow-lg">⚠️ Could not load data. Check console for error details. Message: ${error.message}</p>`;
                    }
                }
            }
            
            // Function to generate HTML Cards (Using the new structure and 3:4 aspect ratio)
            function generateFilmCards() {
                const listContainer = document.getElementById('filmography-list');
                if (!listContainer) return;

                // Clear the loading message
                listContainer.innerHTML = ''; 

                if (filmographyData.length === 0) {
                    listContainer.innerHTML = '<p class="text-gray-600 text-center col-span-full p-8 bg-white rounded-xl shadow-lg">No joint filmography found.</p>';
                    return;
                }

                // Create Cards using the user's requested structure (3:4 aspect ratio)
                listContainer.innerHTML = filmographyData.map((film, index) => `
                    <div class="bg-card-bg rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden cursor-pointer" onclick="showDetailsModal(${index})">
                        <!-- โปสเตอร์และชื่อเรื่อง -->
                        <div class="relative">
                            <img 
                                src="${film.poster}" 
                                alt="โปสเตอร์ ${film.title}" 
                                class="w-full aspect-[4/5] object-cover"
                                onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/333333?text=Poster+N/A';"
                            >
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-gray-900/80 to-transparent p-4">
                                <h3 class="text-2xl font-bold text-white leading-tight">${film.title}</h3>
                            </div>
                        </div>

                        <!-- ข้อมูลหลัก -->
                        <div class="p-4">
                            <span class="text-lg font-semibold text-gray-800">Role: ${film.role2 || '-'}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            // --- CAROUSEL LOGIC ---

            // Function to update the displayed image and button states
            function updateCarouselUI() {
                const imgElement = document.getElementById('modal-poster-slider');
                const counterElement = document.getElementById('image-counter');
                const navLeft = document.getElementById('nav-left');
                const navRight = document.getElementById('nav-right');

                if (!imgElement || currentFilmImages.length === 0) return;

                // Update image source
                const imageUrl = currentFilmImages[currentImageIndex];
                imgElement.src = imageUrl;
                imgElement.onerror = function() { this.src='https://placehold.co/300x400/cccccc/333333?text=IMAGE+N/A'; };
                
                // Update counter
                counterElement.textContent = `${currentImageIndex + 1} / ${currentFilmImages.length}`;

                // Update button states
                navLeft.disabled = (currentImageIndex === 0);
                navRight.disabled = (currentImageIndex === currentFilmImages.length - 1);
            }

            // Function to handle image navigation (called by buttons)
            function navigateImage(direction) {
                const newIndex = currentImageIndex + direction;

                if (newIndex >= 0 && newIndex < currentFilmImages.length) {
                    currentImageIndex = newIndex;
                    updateCarouselUI();
                }
            }


            // Function to show the Modal with film details
            function showDetailsModal(index) {
                const film = filmographyData[index];
                const modal = document.getElementById('details-modal');
                const modalTitle = document.getElementById('modal-title');
                
                const modalRole = document.getElementById('modal-role');
                const modalDate = document.getElementById('modal-date');
                const modalPlatform = document.getElementById('modal-platform');
                const modalEpisodes = document.getElementById('modal-episodes');
                const modalLink = document.getElementById('modal-link');

                if (!film || !modal) return;
                
                // 1. Initialize Image Carousel Data
                currentFilmImages = [];
                // Add all available image URLs (poster is the first image)
                if (film.poster) currentFilmImages.push(film.poster);
                if (film.image2) currentFilmImages.push(film.image2);
                if (film.image3) currentFilmImages.push(film.image3);
                if (film.image4) currentFilmImages.push(film.image4);
                
                // Set initial index
                currentImageIndex = 0;
                
                // If only one image, hide the counter and navigation controls for simplicity
                const posterContainer = document.getElementById('modal-poster-container');
                const navElements = posterContainer.querySelectorAll('#nav-left, #nav-right, #image-counter');
                navElements.forEach(el => el.classList.toggle('hidden', currentFilmImages.length <= 1));

                // 2. Populate Modal data
                modalTitle.textContent = film.title;
                
                // 3. Render Carousel UI
                updateCarouselUI();

                // 4. Details
                modalRole.innerHTML = `<strong class="text-gray-900">Role:</strong> ${film.role || '-'}`;
                modalDate.innerHTML = `<strong class="text-gray-900">Air Date:</strong> ${film.date || '-'}`;
                modalPlatform.innerHTML = `<strong class="text-gray-900">Platform:</strong> ${film.platform || '-'}`;
                modalEpisodes.innerHTML = `<strong class="text-gray-900">Episodes:</strong> ${film.episodes || '-'}`;

                //modalLink.href = film.link;
                // Dynamic link text based on content type
                //modalLink.textContent = film.title.toLowerCase().includes('movie') || film.episodes.toLowerCase().includes('film') ? 'Watch Movie Now' : 'Watch Series Now';

                // 5. Show Modal
                modal.classList.remove('hidden', 'opacity-0');
                modal.classList.add('opacity-100');
            }

            // 6. Function to close Modal
            function closeDetailsModal() {
                const modal = document.getElementById('details-modal');
                modal.classList.add('opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300); // Wait for transition to finish before hiding
            }

            // Fetch data when the page loads
            window.onload = fetchFilmographyData;
        </script>

        <!-- เพลง (Music) -->
        <section id="music" class="py-16 px-4 md:py-24 md:px-8 bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Musics
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8" id="discographyGrid">
                </div>
            </div>
        </section>
        <script>
            function createDiscographyCard(row) {
                const [artist2, date, song, artist, link, img, formatdate] = row;

                return `
                <div class="flex items-center bg-accent-light p-4 rounded-xl shadow-md hover:bg-secondary-blue/30 transition">
                    <img src="${img}" alt="cover" class="w-20 h-20 object-cover rounded-lg mr-4">
                    <div class="flex-grow">
                        <h3 class="text-lg font-semibold text-gray-800">${song}</h3>
                        <p class="text-sm text-gray-600">${artist}</p>
                    </div>
                    <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-primary-blue hover:text-blue-700">
                        <i class="fa-solid fa-circle-play fa-2x"></i>
                    </a>
                </div>

                `;
            }

            function loadDiscographyData(range) {
                const container = document.getElementById("discographyGrid");
                container.innerHTML = `<p class="text-center col-span-full p-8 text-gray-600">loading data...</p>`;

                fetch(`/api/spreadsheets?range=${encodeURIComponent(range)}`)
                .then(res => res.json())
                .then(data => {
                    let rows = data.values || [];

                    if (rows.length === 0) {
                        container.innerHTML = "<p>no data</p>";
                        return;
                    }

                    container.innerHTML = rows.map(createDiscographyCard).join("");
                })
                .catch(err => {
                    console.error(err);
                    container.innerHTML = "<p>error fetch data</p>";
                });
            }
            
            document.addEventListener('DOMContentLoaded', () => {
                loadDiscographyData("discography!A2:Z");
            });
        </script>

        <section id="performance" class="py-16 px-4 md:py-24 md:px-8 bg-accent-light border-b border-gray-200">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Performances
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 place-items-center" id="performanceGrid">
                </div>
            </div>
        </section>
        <section id="cover" class="py-16 px-4 md:py-24 md:px-8 bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Covers
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 place-items-center" id="coverGrid">
                </div>
            </div>
        </section>
        <script>
            function createPerformanceCard(row) {
                const [type, artist, date, song, artist2, link, pic, note, channel, imgchannel] = row;

                return `
                <div class="media-card bg-white rounded-xl shadow-lg overflow-hidden card-hover w-full max-w-md transition transform hover:scale-105">
                    <a href="${link}" target="_blank" class="block">
                        <div class="relative aspect-video">
                            <img src="${pic}" alt="thumbnail" class="w-full h-full object-cover">
                        </div>
                        <div class="flex p-2">
                            <img src="${imgchannel}" alt="channel" class="w-8 h-8 rounded-full mr-2">
                            <div class="flex-1">
                                <h3 class="text-sm font-bold leading-tight hover:text-primary-blue cursor-pointer line-clamp-2">
                                    ${song}
                                </h3>
                                <p class="text-xs text-gray-600 mt-1">${channel} • ${date}</p>
                            </div>
                        </div>
                    </a>
                </div>
                `;
            }

            function loadPerformanceData(range) {
                const container = document.getElementById("performanceGrid");
                const container2 = document.getElementById("coverGrid");
                container.innerHTML = container2.innerHTML = `<p class="text-center col-span-full p-8 text-gray-600">loading data...</p>`;

                fetch(`/api/spreadsheets?range=${encodeURIComponent(range)}`)
                .then(res => res.json())
                .then(data => {
                    let rows = data.values || [];

                    if (rows.length === 0) {
                        container.innerHTML = container2.innerHTML = "<p>no data</p>";
                        return;
                    }

                    container.innerHTML = rows.filter(row => row[0] === "Rec Perf").map(createPerformanceCard).join("");
                    container2.innerHTML = rows.filter(row => row[0] === "Cover").map(createPerformanceCard).join("");
                })
                .catch(err => {
                    console.error(err);
                    container.innerHTML = container2.innerHTML = "<p>error fetch data</p>";
                });
            }
            
            document.addEventListener('DOMContentLoaded', () => {
                loadPerformanceData('performance!A2:Z');
            });
        </script>

        <!-- นิตยสาร (Magazine) -->
        <section id="magazine" class="py-16 px-4 md:py-24 md:px-8 bg-accent-light border-b border-gray-200">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Magazines
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6" id="magazineGrid"></div>
            </div>
        </section>
        <script>
            function createMagazineCard(row) {
                const [artist, date, name, pic, link, note] = row;

                return `
                <div class="text-center" onclick="openLink('${link}')">
                    <div class="w-full aspect-[3/4] overflow-hidden rounded-lg shadow-xl mb-3 border-2 border-primary-blue">
                        <img src="${pic}" 
                            alt="${name}"
                            class="w-full h-full object-cover object-center transition transform hover:scale-105">
                    </div>
                    <p class="text-sm font-medium text-gray-700">${name}</p>
                </div>
                `;
            }

            function loadMagazineData(range) {
                const container = document.getElementById("magazineGrid");
                container.innerHTML = `<p class="text-center col-span-full p-8 text-gray-600">loading data...</p>`;

                fetch(`/api/spreadsheets?range=${encodeURIComponent(range)}`)
                .then(res => res.json())
                .then(data => {
                    let rows = data.values || [];

                    if (rows.length === 0) {
                        container.innerHTML = "<p>no data</p>";
                        return;
                    }

                    container.innerHTML = rows.map(createMagazineCard).join("");
                })
                .catch(err => {
                    console.error(err);
                    container.innerHTML = "<p>error fetch data</p>";
                });
            }
            
            document.addEventListener('DOMContentLoaded', () => {
                loadMagazineData('magazine!A2:Z');
            });
        </script>

        <!-- รายการ (Shows) -->
        <section id="shows" class="py-16 px-4 md:py-24 md:px-8 bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto">

                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Shows
                </h2>

                <!-- Tab Navigation (New Feature) -->
                <div id="media-tabs" class="flex justify-center mb-8 border-b border-blue-200 space-x-4 overflow-x-auto pb-1">
                    <!-- 'All' is active by default -->
                    <!-- <button data-category="all" class="tab-button px-4 py-3 text-lg font-medium text-blue-600 border-b-4 border-blue-500 whitespace-nowrap">All</button>  -->
                    <button data-category="online" class="tab-button px-4 py-3 text-lg font-medium text-blue-600 border-b-4 border-blue-500 whitespace-nowrap">Online</button>
                    <button data-category="bts" class="tab-button px-4 py-3 text-lg font-medium text-gray-500 hover:text-blue-600 border-b-4 border-transparent whitespace-nowrap">BTS</button>
                    <button data-category="press" class="tab-button px-4 py-3 text-lg font-medium text-gray-500 hover:text-blue-600 border-b-4 border-transparent whitespace-nowrap">Press</button>
                    <button data-category="live" class="tab-button px-4 py-3 text-lg font-medium text-gray-500 hover:text-blue-600 border-b-4 border-transparent whitespace-nowrap">Live</button>
                    <button data-category="specials" class="tab-button px-4 py-3 text-lg font-medium text-gray-500 hover:text-blue-600 border-b-4 border-transparent whitespace-nowrap">Specials</button>
                </div>
                
                <div id="media-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 place-items-center">
                    <!-- Media cards will be dynamically loaded here -->
                </div>
            </div>
        </section>
        <script>
            function createShowscard(row) {
                const [type, artist, date, title, link, id, thumbnail, channel, imgchannel, duration] = row;
                return `
                <div data-category="${type.toLowerCase()}" class="media-card bg-white rounded-xl shadow-lg overflow-hidden card-hover w-full max-w-md transition transform hover:scale-105">
                    <a href="${link}" target="_blank" class="block">
                        <div class="relative aspect-video">
                            <img src="${thumbnail}" alt="thumbnail" class="w-full h-full object-cover">
                            <span class="absolute bottom-2 right-2 bg-black bg-opacity-80 text-white text-xs px-1.5 py-0.5 rounded">
                                ${duration}
                            </span>
                        </div>
                        <div class="flex p-2">
                            <img src="${imgchannel}" alt="channel" class="w-8 h-8 rounded-full mr-2">
                            <div class="flex-1">
                                <h3 class="text-sm font-bold leading-tight hover:text-primary-blue cursor-pointer line-clamp-2">
                                    ${title}
                                </h3>
                                <p class="text-xs text-gray-600 mt-1">${channel} • ${date}</p>
                            </div>
                        </div>
                    </a>
                </div>
                `;
            }

            function loadShowsData(range) {
                const container = document.getElementById("media-grid");
                container.innerHTML = `<p class="text-center col-span-full p-8 text-gray-600">loading data...</p>`;

                fetch(`/api/spreadsheets?range=${encodeURIComponent(range)}`)
                    .then(res => res.json())
                    .then(data => {
                        const rows = data.values || [];
                        if (rows.length === 0) {
                            container.innerHTML = "<p>no data</p>";
                            return;
                        }

                        container.innerHTML = rows.map(createShowscard).join("");

                        // ✅ หลังจากโหลดข้อมูลเสร็จแล้ว ค่อย initialize tab filter
                        initTabs();
                    })
                    .catch(err => {
                        console.error(err);
                        container.innerHTML = "<p>error fetch data</p>";
                    });
            }

            function initTabs() {
                const tabs = document.querySelectorAll('.tab-button');
                const mediaCards = document.querySelectorAll('.media-card');

                function filterMedia(category) {
                    const showAll = category === 'all';
                    mediaCards.forEach(card => {
                        const cardCategory = card.getAttribute('data-category');
                        card.style.display = (showAll || cardCategory === category) ? 'block' : 'none';
                    });
                }

                function setActiveTab(clickedTab) {
                    tabs.forEach(tab => {
                        tab.classList.add('text-gray-500', 'border-transparent');
                        tab.classList.remove('text-blue-600', 'border-blue-500');
                    });
                    clickedTab.classList.remove('text-gray-500', 'border-transparent');
                    clickedTab.classList.add('text-blue-600', 'border-blue-500');
                }

                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const category = this.getAttribute('data-category');
                        filterMedia(category);
                        setActiveTab(this);
                    });
                });

                // Default: show all on load
                filterMedia('online');
            }

            document.addEventListener('DOMContentLoaded', () => {
                loadShowsData('shows!A2:Z');
            });
        </script>

        <!-- Brand Presenter (สินค้า/แบรนด์) -->
        <section id="brand-presenter" class="py-16 px-4 md:py-24 md:px-8 bg-accent-light border-b border-gray-200">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Brand Presenter
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-8 justify-items-center items-stretch" id="presenterGrid"></div>
            </div>
        </section>
        <script>
            function createPresenterCard(row) {
                const [artist, date, brand, link, dmd, img] = row;

                return `
                    <div class="w-full max-w-xs p-4 bg-white rounded-xl shadow-lg text-center flex flex-col h-full card-hover">
                        <div class="w-full aspect-[1/1] overflow-hidden rounded-lg mb-4" onclick="openLink('${dmd}')">
                            <img src="${img}" alt="${brand}" class="w-full h-full object-cover object-center transition transform hover:scale-105">
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">${brand}</h3>
                        <p class="text-sm text-gray-500">Start: ${date}</p>
                    </div>
                `;
            }
            function loadPresenterData(range) {
                const container = document.getElementById("presenterGrid");
                container.innerHTML = `<p class="text-center col-span-full p-8 text-gray-600">loading data...</p>`;
                
                fetch(`/api/spreadsheets?range=${encodeURIComponent(range)}`)
                .then(res => res.json())
                .then(data => {
                    let rows = data.values || [];

                    if (rows.length === 0) {
                        container.innerHTML = "<p>no data</p>";
                        return;
                    }

                    container.innerHTML = rows.map(createPresenterCard).join("");
                })
                .catch(err => {
                    console.error(err);
                    container.innerHTML = "<p>error fetch data</p>";
                });
            }
            
            document.addEventListener('DOMContentLoaded', () => {
                loadPresenterData('presenter!A2:Z');
            });
        </script>

        <!-- รางวัลที่ได้รับ (Awards) -->
        <section id="awards" class="py-16 px-4 md:py-24 md:px-8 bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Awards
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-1 xl:grid-cols-2 gap-4" id="awardsGrid"></div>
            </div>
        </section>
        <script>
            function createAwardsCard(row) {
                const [artist, date, award, category, award2, result, link, note, img, icon, resultth] = row;
                return `
                    <div class="flex flex-col md:flex-row items-start bg-accent-light p-5 rounded-xl shadow-lg card-hover">
                        <div class="flex items-start w-full">
                            <i data-lucide="${icon}" class="w-6 h-6 text-primary-blue mr-4 mt-1 flex-shrink-0"></i>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800" onclick="openLink('${link}')">${category}</h3>
                                <p class="${result.toLowerCase()}">${result}</p>
                                <p class="text-gray-700">${award}</p>
                                <p class="text-sm text-gray-500 mt-1">${award2}</p>
                            </div>
                        </div>
                        <div class="mt-4 md:mt-0 md:ml-4 flex-shrink-0 w-full md:w-24 md:h-24 overflow-hidden rounded-md border">
                            <img src="${img}" alt="poster" class="w-full h-full object-cover" onclick="openPopup(['${img}'])">
                        </div>
                    </div>
                `;
            }

            // Function to load awards data from an API
            function loadAwardsData(range) {
                const container = document.getElementById("awardsGrid");
                container.innerHTML = `<p class="text-center col-span-full p-8 text-gray-600">loading data...</p>`;

                fetch(`/api/spreadsheets?range=${encodeURIComponent(range)}`)
                .then(res => res.json())
                .then(data => {
                    let rows = data.values || [];

                    if (rows.length === 0) {
                        container.innerHTML = "<p>ไม่มีข้อมูล</p>";
                        return;
                    }

                    container.innerHTML = rows.map(createAwardsCard).join("");
                    lucide.createIcons();

                })
                .catch(err => {
                    console.error(err);
                    container.innerHTML = "<p>เกิดข้อผิดพลาดในการดึงข้อมูล</p>";
                });
            }

            // Initial call to load data when the page loads
            document.addEventListener('DOMContentLoaded', () => {
                loadAwardsData('awards!A2:Z');
            });
        </script>

        <!-- ตารางงาน (Schedule) - ใช้ Google Sheets Data -->
        <section id="schedule" class="py-16 px-4 md:py-24 md:px-8 bg-accent-light">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-primary-blue text-center mb-12">
                    Schedule
                </h2>
                <!-- Calendar Navigation Header -->
                <div class="bg-white p-4 rounded-t-xl shadow-lg border-b border-gray-200 flex justify-between items-center sticky top-0 z-10">
                    <button onclick="changeMonth(-1)" class="p-2 rounded-full text-gray-600 hover:bg-gray-100 transition duration-150">
                        <i data-lucide="chevron-left" class="w-6 h-6"></i>
                    </button>
                    <div class="flex flex-col items-center">
                        <h3 id="currentMonthDisplay" class="text-2xl font-bold text-blue-700"></h3>
                        <button onclick="goToCurrentMonth()" class="text-xs text-gray-500 hover:text-blue-500 mt-1 transition duration-150">
                            Go to Current Month
                        </button>
                    </div>
                    <button onclick="changeMonth(1)" class="p-2 rounded-full text-gray-600 hover:bg-gray-100 transition duration-150">
                        <i data-lucide="chevron-right" class="w-6 h-6"></i>
                    </button>
                </div>

                <!-- Days of the Week Header -->
                <div class="calendar-grid p-2 bg-blue-600 text-white font-semibold text-center text-sm rounded-none">
                    <div class="py-2 min-w-0">Sun</div>
                    <div class="py-2 min-w-0">Mon</div>
                    <div class="py-2 min-w-0">Tue</div>
                    <div class="py-2 min-w-0">Wed</div>
                    <div class="py-2 min-w-0">Thu</div>
                    <div class="py-2 min-w-0">Fri</div>
                    <div class="py-2 min-w-0">Sat</div>
                </div>

                <!-- Calendar Grid (Dates) -->
                <div id="calendarGrid" class="calendar-grid bg-white p-2 rounded-b-xl shadow-xl">
                    <!-- Calendar Cells will be inserted here by JavaScript -->
                    <div class="loading-spinner col-span-7"></div>
                </div>

                <div class="text-center pt-8">
                    <p class="text-sm text-gray-500">Click on a date to view schedule details</p>
                </div>
            </div>
        </section>

        <!-- Event Detail Modal (Popup) -->
        <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
            <div class="bg-white rounded-lg max-w-xl w-full mx-auto shadow-2xl transform transition-all duration-300 scale-100">
                <div class="flex justify-between items-center p-4 border-b">
                    <h2 class="text-xl font-bold text-blue-700">Event Details</h2>
                    <button id="closeModalButton" class="text-gray-400 hover:text-gray-600 transition duration-150">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    <p id="eventModalDate" class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2"></p>
                    <div id="eventModalBody">
                        <!-- Event list will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        <script>
            let currentMonth = new Date();
            let allScheduleData = {};

            const getDayColorClass = (dow) => {
                switch (dow) {
                    case 'Mon': return 'text-yellow-500';
                    case 'Tue': return 'text-pink-500';
                    case 'Wed': return 'text-green-500';
                    case 'Thu': return 'text-orange-500';
                    case 'Fri': return 'text-blue-500';
                    case 'Sat': return 'text-purple-500';
                    case 'Sun': return 'text-red-500';
                    default: return 'text-gray-800';
                }
            };

            const getBorderColorClass = (dow) => {
                switch (dow) {
                    case 'Mon': return 'border-yellow-500';
                    case 'Tue': return 'border-pink-500';
                    case 'Wed': return 'border-green-500';
                    case 'Thu': return 'border-orange-500';
                    case 'Fri': return 'border-blue-500';
                    case 'Sat': return 'border-purple-500';
                    case 'Sun': return 'border-red-500';
                    default: return 'border-primary-blue';
                }
            };

            // Utility to format Date object to key (YYYY-MM-DD)
            const formatDateKey = (date) => {
                const y = date.getFullYear();
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const d = String(date.getDate()).padStart(2, '0');
                return `${y}-${m}-${d}`;
            };
            
            // Function to parse the date string "DD Mon YYYY" (e.g., "27 Apr 2024") into YYYY-MM-DD
            function parseDateToKey(dateString) {
                if (!dateString) return null;
                
                // Map of standard English month abbreviations to number
                const monthMap = {
                    'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04', 'May': '05', 'Jun': '06',
                    'Jul': '07', 'Aug': '08', 'Sep': '09', 'Oct': '10', 'Nov': '11', 'Dec': '12',
                };

                const parts = dateString.trim().split(/\s+/); // Split by space
                
                if (parts.length < 3) return null;

                const day = parts[0].padStart(2, '0');
                const monthAbbr = parts[1];
                const year = parts[2];
                
                const month = monthMap[monthAbbr];

                if (month) {
                    return `${year}-${month}-${day}`;
                }
                
                // Fallback for other formats (less reliable, but safer than nothing)
                try {
                    const dateObj = new Date(dateString);
                    if (!isNaN(dateObj) && dateObj.getFullYear() > 1900) {
                        return formatDateKey(dateObj);
                    }
                } catch (e) {
                    console.error("Date fallback parsing failed:", e);
                }
                
                return null;
            }


            // 1. Fetch ALL relevant data (assuming data is in '2025!A2:Z' for demonstration)
            async function fetchAllScheduleData() {
                const grid = document.getElementById('calendarGrid');
                grid.innerHTML = '<div class="loading-spinner col-span-7"></div>'; // Show spinner over the whole grid
                
                const range = 'Sheet1!A2:Z'; 

                try {
                    const url = `/api/spreadsheets?range=${encodeURIComponent(range)}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    const rows = data.values || [];
                    
                    allScheduleData = {};

                    rows.forEach(row => {
                        // Columns: 0(date), 1(time), 2(artist), 3(title), ..., 14(dateformat), 15(month), 16(day), 17(dow)
                        const [date, time, artist, title, location, info, img, link, outfit, keyword, tag, note, keylink, taglink, dateformat, month, day, dow] = row;
                        
                        // Use column 0 ('date') and the new parser to generate the key
                        const key = parseDateToKey(date);
                        
                        if (key) { // Use the parsed key (YYYY-MM-DD)
                            if (!allScheduleData[key]) {
                                allScheduleData[key] = [];
                            }
                            allScheduleData[key].push({
                                date, time, artist, title, location, info, img, link, outfit, keyword, tag, note, keylink, taglink, dateformat, month, day, dow
                            });
                        }
                    });

                    renderCalendar(); // Render the calendar once data is loaded

                } catch (error) {
                    console.error("Error fetching schedule data:", error);
                    // Translated error message
                    grid.innerHTML = '<div class="col-span-7 text-center text-red-500 p-4">Could not load schedule data. Please check API Key and Sheet ID.</div>';
                }
            }

            // 2. Render the calendar grid for the currentMonth
            function renderCalendar() {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                
                // Translated month names
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                
                document.getElementById('currentMonthDisplay').textContent = `${monthNames[month]} ${year}`;

                const grid = document.getElementById('calendarGrid');
                grid.innerHTML = ''; // Clear previous grid

                // 1. Calculate start/end days
                const firstDayOfMonth = new Date(year, month, 1);
                const lastDayOfMonth = new Date(year, month + 1, 0);
                const daysInMonth = lastDayOfMonth.getDate();
                
                // Adjust startDayIndex: 0=Sunday, 1=Monday... 
                let startDayIndex = firstDayOfMonth.getDay(); 

                // 2. Fill in leading blanks (previous month)
                for (let i = 0; i < startDayIndex; i++) {
                    grid.innerHTML += `<div class="day-cell p-2 border rounded-md text-right bg-gray-100/50"></div>`;
                }

                // 3. Fill in days of the current month
                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDate = new Date(year, month, day);
                    const dateKey = formatDateKey(currentDate);
                    const events = allScheduleData[dateKey] || [];
                    
                    // Get the day of the week for styling (0=Sun, 6=Sat)
                    const dowIndex = currentDate.getDay();
                    const dowNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    const dow = dowNames[dowIndex];
                    const dayColor = getDayColorClass(dow);

                    // Check if it's today
                    const today = new Date();
                    const isToday = today.toDateString() === currentDate.toDateString();
                    const todayClass = isToday ? 'bg-blue-100 border-2 border-blue-500' : 'bg-white border-gray-200';

                    let eventContent = events.map(event => {
                        // Use a simple colored dot and title for the calendar cell
                        const eventColor = getBorderColorClass(event.dow).replace('border-', 'bg-');

                        return `
                            <!-- Use w-full and min-w-0 truncate to ensure text is clipped correctly within the cell -->
                            <div class="mt-1 text-xs flex items-center w-full cursor-pointer group" onclick="showEventDetails('${dateKey}')">
                                <span class="event-dot ${eventColor} shadow-sm flex-shrink-0"></span>
                                <span class="event-title text-gray-700 font-medium truncate min-w-0 leading-tight">${event.title}</span>
                            </div>
                        `;
                    }).join('');

                    grid.innerHTML += `
                        <div id="day-${dateKey}" class="day-cell p-2 border rounded-md text-right current-month-day ${todayClass} cursor-pointer hover:bg-gray-50 transition duration-150" 
                            onclick="showEventDetails('${dateKey}')">
                            <div class="day-number text-lg font-bold ${dayColor} mb-1">${day}</div>
                            <!-- Add overflow-hidden here to enforce text clipping at cell boundaries -->
                            <div class="event-list text-left space-y-0.5 overflow-hidden">
                                ${eventContent}
                            </div>
                        </div>
                    `;
                }
                
                // 4. Fill in trailing blanks (next month)
                const totalCells = startDayIndex + daysInMonth;
                const remainingCells = 42 - totalCells; // Max 6 rows = 42 cells
                for (let i = 0; i < remainingCells && totalCells + i < 42; i++) {
                    grid.innerHTML += `<div class="day-cell p-2 border rounded-md text-right bg-gray-100/50"></div>`;
                }
            }

            // 3. Navigation functions
            function changeMonth(delta) {
                currentMonth.setMonth(currentMonth.getMonth() + delta);
                renderCalendar();
            }

            function goToCurrentMonth() {
                currentMonth = new Date();
                currentMonth.setDate(1); // Set to 1st of the current month
                renderCalendar();
            }

            // 4. Modal/Popup function to show event details when clicking a day
            function showEventDetails(dateKey) {
                const events = allScheduleData[dateKey] || [];
                const modalBody = document.getElementById('eventModalBody');
                const modalDate = document.getElementById('eventModalDate');
                const modal = document.getElementById('eventModal');

                if (events.length === 0) {
                    modalBody.innerHTML = '<p class="text-gray-500">No schedule found for this date.</p>'; // Translated
                    modalDate.textContent = dateKey; 
                    modal.classList.remove('hidden');
                    return;
                }
                
                // Display date as YYYY-MM-DD
                modalDate.textContent = dateKey; 
                
                modalBody.innerHTML = events.map(event => {
                    const getDayColor = getDayColorClass(event.dow);
                    const borderColor = getBorderColorClass(event.dow);
                    
                    // Artist parsing from original function (simplified)
                    const parseArtists = (name) => {
                        if (name === "PTTP") return ["TeeTee", "Por"];
                        return [name];
                    };
                    const artistImages = {
                        "Por": "https://pbs.twimg.com/media/GuB0uEoWMAAHVIT?format=jpg&name=large",
                        "TeeTee": "https://pbs.twimg.com/media/Gt93Ot5WYAAMRKO?format=jpg&name=4096x4096",
                        "DEXX": "https://pbs.twimg.com/media/G2veDg5bcAAwDpN?format=jpg&name=large"
                    };
                    const artistHTML = parseArtists(event.artist).map(a => `
                        <div class="flex items-center bg-gray-100 rounded-full px-3 py-1 shadow-sm">
                            <img src="${artistImages[a] || 'https://placehold.co/64x64'}" 
                                alt="${a}" 
                                class="w-6 h-6 rounded-full object-cover mr-2">
                            <span class="text-gray-800 font-semibold text-sm">${a}</span>
                        </div>
                    `).join('');

                    const noteMap = {
                        "งานปิดงดติดตาม": "Follow is not allowed",
                        "มีรวมพลหลังเลิกงาน": "Fans gathering after the event",
                        "สามารถไปให้กำลังใจรอบ ๆ งานได้": "All the fans can join in the surrounding area",
                        "แฟนคลับสามารถไปร่วมกิจกรรมได้": "All the fans can joint the event",
                        "เฉพาะผู้มีสิทธิ์เข้าร่วมงาน": "Private Event",
                        "รับของขวัญ": "Can receive gifts",
                    };
                    let noteText = "";
                    if (event.note) {
                        const notes = event.note
                            .split("/")                  // แยกด้วย comma
                            .map(n => n.trim())          // ตัดช่องว่าง
                            .filter(n => n.length > 0)   // ตัดค่าว่าง
                            .map(n => noteMap[n] || n);  // แปลแต่ละอัน
                        noteText = notes.join("/ ");      // รวมกลับ
                    }

                    return `
                        <div class="p-4 mb-4 border-l-4 rounded-lg shadow-md ${borderColor} bg-white">
                            <a href="${event.info}" target="_blank" rel="noopener noreferrer"><h3 class="text-xl font-bold text-gray-900">${event.title}</h3></a>
                            ${event.tag ? `
                                <div class="mt-1 mb-2 text-xs flex flex-col md:flex-row md:space-x-2 space-y-2 md:space-y-0">
                                    ${event.keyword ? `
                                        <span class="bg-blue-200 text-blue-800 px-2 py-0.5 rounded-full font-medium w-fit">
                                            <a href="${event.keylink}" target="_blank" rel="noopener noreferrer">${event.keyword}</a>
                                        </span>` : ''}
                                    ${event.tag ? `
                                        <span class="bg-blue-200 text-blue-800 px-2 py-0.5 rounded-full font-medium w-fit">
                                            <a href="${event.taglink}" target="_blank" rel="noopener noreferrer">${event.tag}</a>
                                        </span>` : ''}
                                </div>
                            ` : ''}
                            <div class="mt-2 text-xs flex flex-wrap gap-2">
                                ${artistHTML}
                            </div>
                            <p class="mt-2 text-sm text-gray-700"><i class="fa-solid fa-clock w-4 mr-1 ${getDayColor}"></i> ${event.time || '-'}</p>
                            <p class="mt-1 text-sm text-gray-700"><i class="fa-solid fa-location-dot w-4 mr-1 ${getDayColor}"></i> ${event.location || '-'}</p>
                            ${noteText ? `<p class="mt-1 text-sm text-gray-700"><i class="fa-solid fa-bullhorn w-4 mr-1 ${getDayColor}"></i> ${noteText}</p>` : ''}
                            
                            ${event.link ? `
                                <div class="mt-3">
                                    <span class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-full text-xs inline-flex items-center transition duration-150">
                                        <i class="fa-brands fa-youtube mr-1"></i>
                                        <a href="${event.link}" target="_blank" rel="noopener noreferrer">Watch Video</a> <!-- Translated -->
                                        <i class="fa-solid fa-arrow-up-right-from-square ml-1"></i>
                                    </span>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');

                modal.classList.remove('hidden');
            }

            function closeModal() {
                document.getElementById('eventModal').classList.add('hidden');
            }

            // --- Initialization ---
            document.addEventListener('DOMContentLoaded', () => {
                currentMonth.setDate(1); // Start viewing from the 1st of the current month
                fetchAllScheduleData();
                
                // Re-create icons (for the prev/next buttons)
                lucide.createIcons();
                
                // Set listener for modal close
                document.getElementById('eventModal').addEventListener('click', (e) => {
                    if (e.target.id === 'eventModal') {
                        closeModal();
                    }
                });
                document.getElementById('closeModalButton').addEventListener('click', closeModal);
            });

        </script>

        <div id="popup" class="popup" onclick="closePopup()">
			<div class="popup-content" onclick="event.stopPropagation()">
				<img id="popup-img" src="" alt="Full-size Event Image" onclick="closePopup()">
				<video id="popup-video" controls style="display: none; max-width: 100%; max-height: 100%;">
					<source id="video-source" src="" type="video/mp4">
					Your browser does not support the video tag.
				</video>
				<button class="nav-btn prev-btn" onclick="prevMedia()">❮</button>
        		<button class="nav-btn next-btn" onclick="nextMedia()">❯</button>
			</div>
		</div>

    </main>

    <!-- Footer -->
    <footer class="bg-primary-blue text-white p-4 text-center">
        <p class="text-sm">&copy; Made with Love | By <a href="https://x.com/yorkorrrr" target="_blank">yorkor</a><br/></p>
    </footer>

    <script src="script.js"></script>

</body>
</html>
